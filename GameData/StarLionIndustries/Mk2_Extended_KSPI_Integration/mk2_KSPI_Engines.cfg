//VASIMR
@PART[M2X_IonEngine]:NEEDS[WarpPlugin]:FIRST
{
	@name = Mk2XVASIMR
	@cost = 20000
	@mass = .75
	!EFFECTS{}
	@TechRequired = advEMSystems
	@title = NFS-13 "Spirit" VASIMR
	@description = A high-power electric engine, modified to fit the mk2 spaceplane form. Propellant is ionized and heated into a plasma and then accelerated by magnetic fields to generate thrust. Thrust is variable and can be increased at the cost of a lower ISP.
	!MODULE[ModuleEngines*]{}
	!MODULE[ModuleEngines*]{}
	!MODULE[MultiModeEngine]{}
	!MODULE[ModuleSurfaceFX]{}
	!MODULE[ModuleSurfaceFX]{}
	MODULE
	{
		name = ModuleEnginesFX
		engineID = VASIMR
		thrustVectorTransformName = thrustTransform
		exhaustDamage = True
		ignitionThreshold = 0.33
		minThrust = 0
		maxThrust = 80.5
		heatProduction = 70
		useEngineResponseTime = FALSE
		useVelocityCurve = False
		atmChangeFlow = FALSE
		useVelCurve = FALSE
		useAtmCurve = FALSE
		runningEffectName = run_vasimr_argon_core
		powerEffectName = run_vasimr_argon_glow
		EngineType = Electric
		PROPELLANT
		{
			name = LqdHydrogen
			ratio = 1
			DrawGauge = True
		}
		atmosphereCurve
		{
			key = 0 29560
		}
		
	}
	EFFECTS
	{
		electric_qvp
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarQVPExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_red
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarLithiumExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_argon
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarArgonExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_xenon
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarXenonExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_hydrogen
		{
			MODEL_MULTI_PARTICLE
			{
			modelName = WarpPlugin/FX/interstellarHydrogenExhaust
			transformName = thrustTransform
			emission = 0.0 0.0
			emission = 0.05 0.05
			emission = 0.075 0.1
			emission = 1.0 1.25
			speed = 0.0 0.5
			speed = 1.0 1.2
			}
		}
		electric_ammonia
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarAmmoniaExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
	}
	!MODULE[ModuleAlternator]{}
	!RESOURCE[ElectricCharge]{}
	
	RESOURCE
	{
		name = WasteHeat
		amount = 0
		maxAmount = 30444.

	}

	MODULE
	{
		name = ElectricEngineControllerFX
		originalName = Vasimr
		upgradedName = Vasimr
		maxPower = 48000
		upgradeCost = 200
		baseISP = 2956
		exitArea = 3.65
		gearsTechReq = advEMSystems
		upgradeTechReq = advEMSystems
		type = 4
		upgradedtype = 4
		powerThrustMultiplier = 1
		ispGears = 10
		baseEfficency = 0.3
		variableEfficency = 0.3
		partMass = 0.75
	}
}

//Vista
@PART[Mk2PLUTO]:NEEDS[WarpPlugin]:FIRST
{
	@name = Mk2Vista
	@TechRequired = fusionRockets
	@title = MBK-2 "Boldly" D-T Vista Inertial Fusion Engine
	@description = The DT Vista propulsion system is an engine that utilises laser induced interial fusion for propulsion.  Pellets of Deuterium and Tritium are compressed to ultra-high densities using a high power laser.  It uses a novel throttle system that actually varies the specific impulse rather than the energy output, it thus always requires 2.5GW of input power, even on minimal throttle.  The crew onboard are shielded by the engine from the intense neutron flux of the fusion reaction but because the reaction occurs outside the ship, other nearby vessels aren't so protected - Beware!
	@cost = 250000
	!fx_exhaustFlame_blue = NULL
	!fx_exhaustLight_blue = NULL
	!fx_smokeTrail_light = NULL
	!sound_vent_medium = NULL
	!sound_rocket_hard = NULL
	!sound_vent_soft = NULL
	!sound_explosion_low = NULL
	
	@mass = 1.34
	@MODULE[ModuleEngines*]
	{
		@name = ModuleEnginesFX
		@maxThrust = 135
		@heatProduction = 100

		!PROPELLANT[*],*{}
		PROPELLANT
		{
			name = LqdHydrogen
			ratio = 1.44
			DrawGauge = True
		}
		PROPELLANT
		{
			name = LqdDeuterium
				ratio = 1.38337941e-3
			DrawGauge = True
		}
		PROPELLANT
		{
			name = LqdTritium
				ratio = 1.38337941e-3
			DrawGauge = True
		}
		!atmosphereCurve{}
		atmosphereCurve
		{
			@key = 0 15500
		}
	}

	MODULE
	{
		name = VistaEngineController
		originalName = Prototype DT Vista Engine
		upgradedName= DT Vista Engine
		upgradeTechReq = advFusionReactions
		maxThrust = 135
		maxThrustUpgraded = 540
		efficiency = 0.19
		killDivider = 50
		leathalDistance = 2000
		powerRequirement = 279.49
		fusionWasteHeat = 279.49
		fusionWasteHeatUpgraded = 1117.97
		wasteHeatMultiplier = 1
		maxTemp = 2500 //3200
		maxAtmosphereDensity = 0.001
	}
	!MODULE[ModuleAlternator]{}
	!RESOURCE[ElectricCharge]{}
	!MODULE[ModuleSurfaceFX]{}
	
	RESOURCE
	{
		name = LqdDeuterium
		amount = 1
		maxAmount = 1
	}

	RESOURCE
	{
		name = LqdTritium
		amount = 1
		maxAmount = 1
	}
	RESOURCE
    {
		name = WasteHeat
		amount = 0
		maxAmount = 1200000
    }

	MODULE
	{
		name = ModuleElementRadioactiveDecay
		decayConstant = 1.7915586e-9
		resourceName = LqdTritium
		decayProduct = LqdHe3
		convFactor = 1
	}
}

//Plasma Thruster
@PART[ESTOC]:NEEDS[WarpPlugin]:FIRST
{
	@name = Mk2PlasmaThruster
	@cost = 8000
	@mass = 1
	!EFFECTS{}
	@TechRequired = plasmaPropulsion
	@title = WYGC-4 "Buster" Plasma Thruster
	@description = A larger and more efficient cousin of the ion engine, it is best not to attempt to power this engine with witchcraft and instead opt for a very large electric generator.
	!MODULE[ModuleEngines*]{}
	!MODULE[ModuleEngines*]{}
	!MODULE[MultiModeEngine]{}
	!MODULE[ModuleSurfaceFX]{}
	!MODULE[ModuleSurfaceFX]{}
	MODULE
	{
		name = ModuleEnginesFX
		engineID = PlasmaThruster
		thrustVectorTransformName = thrustTransform
		exhaustDamage = True
		ignitionThreshold = 0.33
		minThrust = 0
		maxThrust = 80.5
		heatProduction = 70
		useEngineResponseTime = FALSE
		useVelocityCurve = False
		atmChangeFlow = FALSE
		useVelCurve = FALSE
		useAtmCurve = FALSE
		EngineType = Electric
		PROPELLANT
		{
			name = LqdHydrogen
			ratio = 1
			DrawGauge = True
		}
		atmosphereCurve
		{
			key = 0 11213
		}
		
	}
	
	EFFECTS
	{
		electric_qvp
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarQVPExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_red
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarLithiumExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_argon
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarArgonExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_xenon
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarXenonExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		electric_hydrogen
		{
			MODEL_MULTI_PARTICLE
			{
			modelName = WarpPlugin/FX/interstellarHydrogenExhaust
			transformName = thrustTransform
			emission = 0.0 0.0
			emission = 0.05 0.05
			emission = 0.075 0.1
			emission = 1.0 1.25
			speed = 0.0 0.5
			speed = 1.0 1.2
			}
		}
		electric_ammonia
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WarpPlugin/FX/interstellarAmmoniaExhaust
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.05
				emission = 0.075 0.1
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
	}
	!MODULE[ModuleAlternator]{}
	!RESOURCE[ElectricCharge]{}
	
	RESOURCE
	{
		name = WasteHeat
		amount = 0
		maxAmount = 174274
	}

	MODULE
	{
		name = ElectricEngineControllerFX
		originalName = Magnetoplasmadynamic
		upgradedName = Quantum Vacuum
		maxPower = 21784.23
		upgradeCost = 200
		baseISP = 2956
		exitArea = 0.6672
		gearsTechReq = advEMSystems
		upgradeTechReq = specializedPlasmaGeneration
		type = 1
		upgradedtype = 8
		powerThrustMultiplier = 1
		ispGears = 1
		partMass = 1
	}
	!MODULE[ModuleSurfaceFX]{}
}

@PART[M2X_AtomicJet]:NEEDS[WarpPlugin]:FIRST
{
	@name = Mk2ThermalTurbojet
	@mass = 0.3778
	@cost = 9000
	@title = R4-D "Rontgen" Atomic Thermal TurboJet
	@description = Instead of a combustion chamber, this turbojet features a heat exchanger to heat and expel exhaust at high velocity.
	@maxTemp = 2750
	@TechRequired = improvedNuclearPropulsion
	@MODULE[ModuleEnginesFX]
	{
		@engineAccelerationSpeed = .35
		@engineDecelerationSpeed = 0.45
		@useVelocityCurve = True
		@maxThrust = 300
		@PROPELLANT[IntakeAir]
		{
			@name = IntakeAtm
			@ignoreForIsp = FALSE
			@ratio = 1
			%DrawGauge = True
		}
		!PROPELLANT[EnrichedUranium]{}
		!PROPELLANT[DepletedFuel]{}
		// Jet params
		!machLimit = NULL
		!machHeatMult = NULL
		!atmosphereCurve{}
		!atmChangeFlow = NULL
		!useVelCurve = NULL
		!useAtmCurve = NULL
		!velCurve{}
		!atmCurve{}
		
		atmosphereCurve
		{
			key = 0 2000 0 0 
		}
		velocityCurve
		{
			key = 0 1 0 0
			key = 400 0.8 0 0
			key = 800 0.9 0 0
			key = 1700 0 0 0
		}
		!RESOURCE
	}
	!MODULE[ModuleAlternator]{}
	!RESOURCE[ElectricCharge]{}

	MODULE
	{
		name = ThermalNozzleController
		isJet = true
		originalName = Atmospheric Thermal Jet
		upgradedName = Hybrid Thermal Rocket
		upgradeCost = 750
		upgradeTechReq = aerospaceTech
		radius = 1.965
		exitArea = 2.04
		powerTrustMultiplier = 1.5
		IspTempMultOffset = -1.371670613
		sootHeatDivider = 50
		heatProductionMult = 5.5
		emisiveConstantMult = 3
		emisiveConstantExp = 0.6
		maxTemp = 2750
		baseHeatProduction = 26.54
		partMass = 1.41
	}
	
	!MODULE[ModuleResourceIntake]{}
	!RESOURCE[Intake*]{}
	RESOURCE
	{
		name = WasteHeat
		amount = 0
		maxAmount = 150000
	}
	!RESOURCE[EnrichedUranium]{}
	!RESOURCE[DepletedFuel]{}
	!MODULE[ModuleSurfaceFX]{}
	!MODULE[ModuleSurfaceFX]{}
}

//Magnetic Nozzle
@PART[Mk2Turbojet]:NEEDS[WarpPlugin]:FIRST
{
	@name = Mk2MagneticNozzle
	@TechRequired = advNuclearPropulsion
	@cost = 96119
	@mass = .87
	@title = G-120 "Vector" Magnetic Nozzle
	@description = The Magnetic Nozzle is an advanced alternative to the thermal rocket which can expel high temperature charged exhaust at extremely high velocities  because the propellant is confined electromagnetically instead of physically.  It does require electric power and, of of course, only operates off reactors that generate charged particles. Not rated for atmospheric use.
	
	@MODULE[ModuleEngines*]
	{
		@name = WarpModuleEnginesFX
		%engineID = MagneticNozzle
		resourceDeltaV = LqdHydrogen
		@maxThrust = 1176
		@heatProduction = 100
		@useEngineResponseTime = FALSE
		!engineAccelerationSpeed = 1.0
		@useVelocityCurve = False
		!engineDecelerationSpeed = 1.0
		!engineSpoolIdle = NULL
		!engineSpoolTime = NULL
		%EngineType = Electric
		%runningEffectName = running_closed
		@PROPELLANT[LiquidFuel]
		{
			@name = LqdHydrogen
		}
		!PROPELLANT[IntakeAir]{}
		@atmosphereCurve
		{
			@key,0 = 0 36000
			key = 1 32000
		}

		// Jet params
		!atmChangeFlow = FALSE
		!useVelCurve = FALSE
		!useAtmCurve = FALSE
		!machHeatMult = NULL
		!machLimit = NULL
		!velCurve{}
		!atmCurve{}
	}
	
	!RESOURCE[ElectricCharge]{}
	!MODULE[ModuleAlternator]{}
	!MODULE[ModuleSurfaceFX]{}
	MODULE
	{
		name = InterstellarMagneticNozzleControllerFX
		radius = 1.965
		powerThrustMultiplier = 1
	}
	RESOURCE
	{
		name = WasteHeat
		amount = 0
		maxAmount = 87137
	}
	!MODULE[ModuleSurfaceFX]{}
}

// fixes issues from conflicts with mk2-E's own patches
@PART[Mk2Vista]:NEEDS[WarpPlugin]:FINAL
{
	@TechRequired = fusionRockets
	@MODULE[ModuleEngines*]
	{
		!PROPELLANT[EnrichedUranium]{}
		!PROPELLANT[DepletedFuel]{}
		!PROPELLANT[EnrichedUranium]{}
		!PROPELLANT[DepletedFuel]{}
	}
	!RESOURCE[EnrichedUranium]{}
	!RESOURCE[DepletedFuel]{}
	!RESOURCE[EnrichedUranium]{}
	!RESOURCE[DepletedFuel]{}
}

@PART[Mk2ThermalTurbojet]:NEEDS[WarpPlugin]:FINAL
{
	@TechRequired = improvedNuclearPropulsion
	@mass = .3778
	@MODULE[*ModuleEngines*]
	{
		!PROPELLANT[EnrichedUranium]{}
		!PROPELLANT[DepletedFuel]{}
		!PROPELLANT[EnrichedUranium]{}
		!PROPELLANT[DepletedFuel]{}
	}
	!RESOURCE[*],*{}
}

@PART[*]:HAS[@MODULE[KM_Gimbal_3]]:NEEDS[!Klockheed_Martian_Gimbal]
{
	%MODULE[ModuleGimbal]
	{
		%gimbalTransformName = #$../[ModuleEngines*]/thrustVectorTransformName$
		%gimbalRange = 1
	}
	!MODULE[KM_Gimbal_3]{}
}